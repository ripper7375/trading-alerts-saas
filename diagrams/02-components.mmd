graph TB
    subgraph Browser["üåê Browser / Client"]
        Dashboard["üìä Dashboard Page"]
        Charts["üìà Charts Page"]
        Alerts["üîî Alerts Page"]
        Settings["‚öôÔ∏è Settings Page"]
        Admin["üëë Admin Page"]
        Pricing["üí∞ Pricing Page"]
    end
    
    subgraph NextJS["Next.js Application Container"]
        subgraph Frontend["Frontend Layer (React Components)"]
            TradingChart["TradingView Charts<br/>(lightweight-charts)"]
            Forms["React Hook Forms<br/>(Zod validation)"]
            StateManagement["State Management<br/>(Zustand + React Query)"]
            WSClient["WebSocket Client<br/>(Socket.IO Client)"]
        end
        
        subgraph APILayer["API Layer (Next.js Routes)"]
            AuthAPI["/api/auth/*<br/>Authentication routes"]
            UserAPI["/api/user/*<br/>User management"]
            IndicatorAPI["/api/indicators/*<br/>Indicator data"]
            AlertAPI["/api/alerts/*<br/>Alert management"]
            WatchlistAPI["/api/watchlist/*<br/>Watchlist management"]
            NotificationAPI["/api/notifications/*<br/>Notifications"]
            AdminAPI["/api/admin/*<br/>Admin operations"]
            SubAPI["/api/subscription<br/>Subscription info"]
            CheckoutAPI["/api/checkout<br/>Stripe checkout sessions"]
            WebhookAPI["/api/webhooks/stripe<br/>Payment webhooks"]
            InvoiceAPI["/api/invoices<br/>Invoice history"]
            HealthAPI["/api/health<br/>System health"]
        end
        
        subgraph Auth["Authentication Layer"]
            NextAuth["NextAuth.js<br/>(Session provider)"]
            JWT["JWT Tokens"]
            SessionMgmt["Session Management"]
        end
        
        subgraph Services["Business Logic"]
            MT5Client["MT5 Client<br/>(Flask API caller)"]
            AlertChecker["Alert Checker<br/>(Background jobs)"]
            EmailService["Email Service<br/>(Resend)"]
            StripeService["Stripe Service<br/>(Payment processing)"]
        end
    end
    
    subgraph WebSocketServer["WebSocket Server Container"]
        SocketIO["Socket.IO Server<br/>(Real-time engine)"]
        ConnectionMgr["Connection Manager<br/>(User sessions)"]
        EventEmitter["Event Emitter<br/>(Notifications)"]
    end
    
    subgraph Flask["Flask MT5 Service Container"]
        FlaskAPI["REST API<br/>(Flask routes)"]
        MT5Connection["MT5 Connection<br/>(MetaTrader5 lib)"]
        BufferReader["Indicator Buffer Reader<br/>(Reads MQL5 buffers)"]
    end
    
    subgraph DataLayer["Data Layer"]
        Prisma["Prisma ORM<br/>(TypeScript)"]
        PostgresDB[("PostgreSQL<br/>Database")]
        RedisCache[("Redis<br/>Cache & Queue")]
    end
    
    Browser --> Frontend
    Frontend --> APILayer
    Frontend --> WSClient
    WSClient -.->|"WebSocket"| SocketIO
    
    APILayer --> Auth
    APILayer --> Services
    Auth --> NextAuth
    
    Services --> MT5Client
    Services --> EmailService
    Services --> StripeService
    
    MT5Client --> FlaskAPI
    FlaskAPI --> MT5Connection
    MT5Connection --> BufferReader
    
    APILayer --> Prisma
    Prisma --> PostgresDB
    
    Services --> RedisCache
    Services -.->|"Publish events"| RedisCache
    
    SocketIO --> ConnectionMgr
    SocketIO --> EventEmitter
    SocketIO -.->|"Subscribe"| RedisCache
    EventEmitter -.->|"Emit to clients"| WSClient
    
    style Browser fill:#E3F2FD,stroke:#1976D2
    style NextJS fill:#F3E5F5,stroke:#7B1FA2
    style WebSocketServer fill:#EDE7F6,stroke:#5E35B1
    style Flask fill:#E8F5E9,stroke:#388E3C
    style DataLayer fill:#FFF3E0,stroke:#F57C00